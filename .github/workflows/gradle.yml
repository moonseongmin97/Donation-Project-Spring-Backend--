# 2. JAR 파일을 서버로 전송 (SCP)
    - name: Copy JAR to Server
      uses: appleboy/scp-action@v0.1.7
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        port: 2222  # <--- SSH 포트 번호 추가
        source: "build/libs/*.jar"
        target: "/home/ubuntu/app"
        strip_components: 2

    # 3. 서버에서 기존 앱 끄고 새 앱 실행 (SSH)
    - name: Execute remote ssh commands
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        port: 2222  # <--- 여기도 포트 번호 추가
        script: |
          # 1. 기존 실행 중인 자바 프로세스 종료 (서비스 포트 8080 기준)
          sudo fuser -k 8080/tcp || true
          
          # 2. 기존 JAR 파일 정리
          rm -rf /home/ubuntu/app/*.jar.bak
          
          # 3. 새 JAR 실행 (로그는 app.log에 기록)
          nohup java -jar /home/ubuntu/app/*.jar > /home/ubuntu/app/app.log 2>&1 &
